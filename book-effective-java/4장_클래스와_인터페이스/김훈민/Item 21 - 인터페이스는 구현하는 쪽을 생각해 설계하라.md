# Item 21 - 인터페이스는 구현하는 쪽을 생각해 설계하라

- 자바 8 이후부터는 기존 구현체를 깨지않고 인터페이스에 메서드를 추가할 수 있게 되었다.
- 디폴트 메서드를 선언하면, 그 인터페이스를 구현한 후 디폴트 메서드를 재정의하지 않은 모든 클래스에서 디폴트 구현이 쓰이게 된다.
    - 그런데, 매끄럽게 연동되리라라는 보장은 없다
    - 자바 7 까지는 모든 클래스가 현재의 인터페이스에 새로운 메서드가 추가될 일은 영원히 없다고 가정하고 작성되었기 때문이다.

### 그래서, 생각할 수 있는 모든 상황에서 불변식을 해치지 않는 디폴트 메서드를 작성하기란 어려운 일이다.

```java
default boolean removeIf(Predicate<? super E> filter) {  
	Objects.requireNonNull(filter);  
	boolean removed = false;  
	final Iterator<E> each = iterator();  
	while (each.hasNext()) {  
		 if (filter.test(each.next())) {  
			 each.remove();  
			 removed = true;  
		 }  
	}  
	return removed;  
}
```

위 코드는 자바 8의 Collection 인터페이스에 추가된 디폴트 메서드이다.

범용적으로 사용하고 있지만, 아직까지는 모든 구현체와 잘 어울리지는 않는다.

### 어떻게 이 문제를 예방할 수 있을까?

해당 메서드를 재정의하고 이를 호출하는 다른 메서드들은 디폴트 구현을 호출하기전에 동기화하도록 하였다.

### 그렇다면 어떻게 해야할까?

1. 인터페이스를 설계할때는 여전히 세심한 주의를 기울여야 한다.
    1. 새로운 인터페이스라면 릴리스 전에 반드시 테스트를 거치도록 하자
2. 인터페이스를 릴리스한 후라도 결함을 수정하는 게 가능한 경우도 있겠지만, 절대 그 가능성에 기대서는 안된다.